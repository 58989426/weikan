<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <script type="text/javascript" src="../../script/common.js"></script>

      <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
      <style>
        body{
          background: #fff
        }
        .book-channel{
          padding: 0 0.5rem;
        }
        .book-img {
          height: 5.5rem;
        }
        .list_bg_content{
          position: relative;
        }
        .list_bg{
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0px;
            right: 0;
            background: rgba(0,0,0,.5);
        }
        .icon_check {
            position: absolute;
            right: 5px;
            font-size: 20px;
            color: white;
        }
        .icon-gouquan{
            font-size: 18px;
            margin-top: 2px;
            margin-right: 1px;
        }
        .icon-gouquan:before {
            content: "\e602";
            background: #f56c6c;
            border-radius: 20px;
        }
        .book-add{
          width: 100%;
          height: 5.5rem;
          border: 0.5px dashed #ff3955;
          text-align: center;
        }
        .aui-icon-plus{
          font-size: 30px;
          color: #ff3955;
          margin-top: 1.2rem;
          display: block;
        }
      </style>
  </head>
  <body>
    <section class="book-channel">
      <div>
        <div @click="editChange" class="aui-pull-left"><span class="aui-iconfont aui-icon-edit"></span> {{edit?'取消':'编辑'}}</div>
        <div v-show="edit" @click="deleteCollection" class="aui-pull-right"><span class="aui-iconfont aui-icon-trash"></span> 删除</div>
      </div>
      <div class="aui-row-padded style1 aui-clearfix">
        <div class="aui-col-xs-4" v-for="item in dataLists">
          <div class="list_bg_content" >
            <img :src='item.img' class='book-img'></img>
            <div class="list_bg" @click.stop="check(item)" v-show="edit">
                <i class="iconfont  icon_check" :class="item.check?'icon-gouquan':'icon-iconheji_huabanfuben-'"></i>
            </div>
          </div>
          <div class="item-book-name aui-ellipsis-2">{{item.name}}</div>
          <div class="item-book-intro aui-ellipsis-1">{{item.shortIntro}}</div>
        </div>
        <div class="aui-col-xs-4">
          <div class="book-add" @click="addmore">
            <i class="aui-iconfont aui-icon-plus"></i>
            <div class="item-book-name" style="text-align:center;color: #ff3955;">添加小说</div>
          </div>
        </div>
      </div>
    </section>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/vue.min.js"></script>
  <script type="text/javascript" src="../../script/underscore.js"></script>
  <script type="text/javascript">
      var indexSetting = {};

      if ($api.getStorage('localstore')) {
          indexSetting.localstore = $api.getStorage('localstore');

      } else {
          indexSetting.localstore = {
              data: []
          };
      }
      apiready = function(){

      };
      var vm=new Vue({
          el:".book-channel",
          data:{
            edit:false,
            dataLists:indexSetting.localstore.data,
            deleteList:[]
          },
          mounted: function () {

          },
          methods:{
            //编辑或取消
            editChange:function () {
              vm.edit = !vm.edit;
              //如果取消编辑  清空选中的数据
              if(!vm.edit){
                  _.each(vm.dataLists, function(item){
                      item.check=false;
                    });
              }
            },
            //选中或取消
            check:function (item) {
                item.check=!item.check;
            },
            // 删除
            deleteCollection:function () {
      				//得到选择要删除的数据集合
      				vm.deleteList = _.map(
      					_.filter(vm.dataLists, function(item){
      							return item.check;
      						}),
      					function (i) {
      						return i.id;
      					});

      				if(vm.deleteList.length>0){
      					//调用删除接口
      					var parmes={id:vm.deleteList};

                // //还原初始值
                // vm.edit=false;
                // vm.deleteList=[];
                // //去掉已被删除的数据
                // vm.dataLists=_.filter(vm.dataLists,
                //   function(item){
                //     return !item.check;
                //   })

      				}else{
      					alert('您还未选中小说！');
      				}
            },
            toDetails:function(item){
              api.openWin({
                  name: 'bookdetails',
                  url: 'bookdetails.html',
                  pageParam: {type: item}
                });
            },
            addmore:function(){
              api.execScript({
                  name: 'root',
                  script: 'navbottom(2);'
              });
              api.openFrame({
                  name: 'index',
                  url: 'index.html',
                  pageParam: {},
              })
              api.closeFrame();
            }
          },
      });
  </script>
  </html>
